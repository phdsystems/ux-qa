# @ux.qa/scanner

Scan UI projects and auto-generate Playwright test scaffolds with coverage analysis.

## Installation

```bash
# npm
npm install -D @ux.qa/scanner

# bun
bun add -d @ux.qa/scanner

# pnpm
pnpm add -D @ux.qa/scanner
```

## Quick Start

```bash
# Scan your project and see coverage report
npx uxqa-scanner scan --root ./src

# Generate test scaffolds for untested components
npx uxqa-scanner generate --write

# Initialize configuration file
npx uxqa-scanner init
```

## Commands

### `scan` - Analyze project coverage

```bash
uxqa-scanner scan [options]
```

Analyzes your project and reports:
- Components with/without tests
- Interactive elements with/without `data-testid`
- Routes/pages coverage
- Suggested `data-testid` additions

### `generate` - Create test scaffolds

```bash
uxqa-scanner generate [options]
```

Generates Playwright test files for untested components including:
- Visibility tests for elements
- Click handlers for buttons
- Navigation tests for links
- Form submission tests
- Input field tests

### `init` - Create config file

```bash
uxqa-scanner init
```

Creates `uxqa-scanner.config.json` with default settings.

## Options

| Option | Alias | Description | Default |
|--------|-------|-------------|---------|
| `--root` | `-r` | Root directory to scan | `./src` |
| `--out` | `-o` | Output directory for tests | `./tests/e2e` |
| `--framework` | `-f` | Framework: react, vue, html, auto | `auto` |
| `--base-url` | `-b` | Base URL for tests | `http://localhost:5173` |
| `--include` | `-i` | Include patterns (comma-separated) | `**/*.tsx,**/*.jsx` |
| `--exclude` | `-e` | Exclude patterns (comma-separated) | `**/node_modules/**` |
| `--write` | `-w` | Write generated tests to files | `false` |
| `--json` | | Output JSON report | `false` |

## Configuration File

Create `pw-scanner.config.json` in your project root:

```json
{
  "rootDir": "./src",
  "outDir": "./tests/e2e",
  "framework": "auto",
  "include": ["**/*.tsx", "**/*.jsx"],
  "exclude": ["**/node_modules/**", "**/*.test.*", "**/*.spec.*"],
  "baseUrl": "http://localhost:5173",
  "suggestTestIds": true
}
```

## Package.json Scripts

```json
{
  "scripts": {
    "test:coverage": "uxqa-scanner scan",
    "test:generate": "uxqa-scanner generate --write",
    "test:report": "uxqa-scanner scan --json > coverage.json"
  }
}
```

## Programmatic Usage

```typescript
import { createScanner, generateTestFile } from '@ux.qa/scanner';

// Create scanner instance
const scanner = createScanner({
  rootDir: './src',
  framework: 'react',
});

// Scan project
const result = await scanner.scan();

console.log(`Found ${result.components.length} components`);
console.log(`Coverage: ${result.coverage.testedComponents}/${result.coverage.totalComponents}`);

// Generate test for a component
const testFile = generateTestFile(result.components[0], {
  includeVisibility: true,
  includeInteractions: true,
  addTodos: true,
});

console.log(testFile.content);
```

## What Gets Analyzed

### React Components
- Function components
- Arrow function components
- Class components (basic support)
- Props interfaces/types

### Interactive Elements
- Buttons (`<button>`, elements with `onClick`)
- Links (`<a>`)
- Inputs (`<input>`, `<textarea>`, `<select>`)
- Forms (`<form>`)
- Checkboxes and radio buttons

### Attributes Extracted
- `data-testid` (existing)
- `aria-label`
- `name`, `id`
- Event handlers (`onClick`, `onSubmit`, etc.)

## Generated Test Example

```typescript
import { test, expect } from '@playwright/test';

/**
 * Auto-generated tests for LoginForm
 * Generated by @ux.qa/scanner
 */
test.describe('LoginForm', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/login');
  });

  test('should render LoginForm elements', async ({ page }) => {
    await expect(page.locator('[data-testid="email-input"]')).toBeVisible();
    await expect(page.locator('[data-testid="password-input"]')).toBeVisible();
    await expect(page.locator('[data-testid="submit-button"]')).toBeVisible();
  });

  test('should handle submit-button click', async ({ page }) => {
    const button = page.locator('[data-testid="submit-button"]');
    await expect(button).toBeVisible();
    await button.click();
    // TODO: Add assertion for expected behavior after click
  });

  test('should accept input in email-input', async ({ page }) => {
    const input = page.locator('[data-testid="email-input"]');
    await expect(input).toBeVisible();
    await input.fill('test@example.com');
    await expect(input).toHaveValue('test@example.com');
  });
});
```

## Best Practices

1. **Add `data-testid` to interactive elements** - Scanner suggests IDs for elements missing them
2. **Review generated tests** - They're scaffolds, not complete tests
3. **Fill in TODO comments** - Add meaningful assertions
4. **Run regularly** - Integrate into CI to track coverage trends

## Integration with UX.QA

Results can be published to [UX.QA](https://github.com/adentic/ux.qa) dashboard:

```bash
# Run scan and publish results
UXQA_URL=http://localhost:3000 uxqa-scanner scan --json | \
  curl -X POST -H "Content-Type: application/json" -d @- $UXQA_URL/api/coverage
```

## License

MIT
